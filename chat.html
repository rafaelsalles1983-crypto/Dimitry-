<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>—á–∞—Ç üåç</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-primary: #4CAF50;
  --color-primary-hover: #45a049;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:Arial, sans-serif; background:var(--color-bg-light); }

/* HEADER */
header { background:#fff; padding:10px; border-bottom:1px solid #ddd; display:flex; align-items:center; gap:8px; position:fixed; top:0; left:0; right:0; z-index:10; }
header h1 { color:var(--color-primary); font-size:1.3em; display:flex; align-items:center; gap:6px; }
.emoji-head { width:28px; }

/* TOPBAR */
#topBar { display:flex; gap:8px; padding:8px; background:#fafafa; border-bottom:1px solid #ddd; margin-top:50px; flex-wrap:wrap; justify-content:space-between; align-items:center; }
#topBar button { background:white; color:var(--color-primary); border:1px solid var(--color-primary); border-radius:5px; padding:6px 10px; cursor:pointer; }
#topBar span { font-size:0.9em; }

/* MAIN */
#mainContent { display:flex; height:calc(100vh - 130px); }

/* USERLIST */
#userList { width:200px; background:white; border-right:1px solid #ddd; overflow-y:auto; }
.userItem { display:flex; align-items:center; gap:6px; padding:6px; cursor:pointer; border-radius:5px; margin:4px; }
.userItem:hover { background:#e8f8ee; }
.userItem img { width:28px; height:28px; border-radius:50%; }

/* CHAT */
#chatContainer { flex:1; display:flex; flex-direction:column; background:white; border-left:1px solid #ddd; }
#chatHeader { padding:6px; background:#fafafa; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center; }
#chatHeader h2 { font-size:1em; color:#333; }
#chatWindow { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; }
.msg { margin:5px 0; padding:8px; border-radius:8px; max-width:80%; word-wrap:break-word; position:relative; }
.userMsg { background:#e0f7e9; align-self:flex-end; text-align:right; }
.otherMsg { background:#fff8dc; align-self:flex-start; text-align:left; }
.msg small { display:block; font-size:0.7em; color:#666; margin-top:4px; }

/* DELETE BUTTON */
.deleteBtn { position:absolute; bottom:2px; right:4px; background:transparent; border:none; color:red; cursor:pointer; font-size:0.7em; display:none; }
.msg:hover .deleteBtn { display:inline; }

/* INPUT */
#chatInput { display:flex; border-top:1px solid #ddd; }
#chatInput input { flex:1; padding:10px; border:none; outline:none; }
#chatInput button { background:var(--color-primary); color:white; border:none; padding:10px 15px; cursor:pointer; }

/* ADS */
#adSidebar { width:250px; background:#f7f7f7; border-left:1px dashed #ccc; text-align:center; padding:8px; }


/* MOBILE */
@media(max-width:768px){
  #mainContent { flex-direction:column; height:auto; }
  #adSidebar { display:none; }
  #userList { width:100%; order:-1; display:flex; overflow-x:auto; border-bottom:1px solid #ddd; }
  .userItem { flex:0 0 auto; margin:2px; padding:4px; }
  footer { position:fixed; bottom:0; left:0; right:0; }
}
</style>
</head>
<body>

<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
</header>

<div id="topBar">
  <div>
    <button id="loginBtn">Login com Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="generalBtn" style="display:none;">üí¨ Bate-papo Geral</button>
  </div>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<div id="mainContent">
  <div id="userList"></div>

  <div id="chatContainer">
    <div id="chatHeader">
      <h2 id="chatTitle">üí¨ Bate-papo Geral</h2>
    </div>
    <div id="chatWindow"></div>
    <div id="chatInput">
      <input id="msgInput" type="text" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>

  <div id="adSidebar">Publicidade (Adsense)</div>
</div>


<audio id="msgSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a8c4e8d5a.mp3?filename=message-pop-alert-23584.mp3" preload="auto"></audio>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
  authDomain: "dimitry-rusian.firebaseapp.com",
  databaseURL: "https://dimitry-rusian-default-rtdb.firebaseio.com",
  projectId: "dimitry-rusian",
  storageBucket: "dimitry-rusian.appspot.com",
  messagingSenderId: "449029666805",
  appId: "1:449029666805:web:feaf575a7b7e6f234a52bc"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const generalBtn = document.getElementById("generalBtn");
const userList = document.getElementById("userList");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const chatWindow = document.getElementById("chatWindow");
const chatTitle = document.getElementById("chatTitle");
const msgSound = document.getElementById("msgSound");
const onlineCount = document.getElementById("onlineCount");

let currentUser=null, currentChat="chatGlobal", currentPartner=null;
let chatListener=null;

// LOGIN
loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(u=>{
  if(u){
    currentUser=u;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    generalBtn.style.display="inline-block";
    msgInput.disabled=false;
    sendBtn.disabled=false;
    db.ref("online/"+u.uid).set({name:u.displayName,photo:u.photoURL});
    db.ref("online/"+u.uid).onDisconnect().remove();
    updateUsers();
    openGlobal();
  } else {
    currentUser=null;
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    generalBtn.style.display="none";
    msgInput.disabled=true;
    sendBtn.disabled=true;
    chatWindow.innerHTML="";
    updateUsers();
  }
});

// LISTA DE USU√ÅRIOS ONLINE
function updateUsers(){
  db.ref("online").on("value",snap=>{
    const data=snap.val()||{};
    userList.innerHTML="";
    onlineCount.textContent="üë• Usu√°rios online: "+Object.keys(data).length;
    for(const [uid,u] of Object.entries(data)){
      if(currentUser && uid===currentUser.uid) continue;
      const div=document.createElement("div");
      div.className="userItem";
      div.innerHTML=`<img src="${u.photo}"><span>${u.name}</span>`;
      div.onclick=()=>openPrivate(uid,u.name);
      userList.appendChild(div);
    }
  });
}

// LIMPA OUVINTES
function clearChatListener(){
  if(chatListener){ chatListener.off(); chatListener=null; }
}

// ABRIR CHAT GERAL
function openGlobal(){
  clearChatListener();
  currentChat="chatGlobal";
  currentPartner=null;
  chatTitle.textContent="üí¨ Bate-papo Geral";
  chatWindow.innerHTML="";
  chatListener=db.ref("chatGlobal");
  chatListener.on("child_added",snap=>renderMsg(snap.key,snap.val()));
}

// ABRIR CHAT PRIVADO
function openPrivate(uid,name){
  clearChatListener();
  currentPartner=uid;
  currentChat="private/"+[currentUser.uid,uid].sort().join("_");
  chatTitle.textContent="üë§ "+name;
  chatWindow.innerHTML="";
  chatListener=db.ref(currentChat);
  chatListener.on("child_added",snap=>renderMsg(snap.key,snap.val()));
}

// RENDER MENSAGEM
function renderMsg(key,m){
  const div=document.createElement("div");
  div.className=m.uid===currentUser?.uid?"msg userMsg":"msg otherMsg";
  div.innerHTML=`<strong>${m.user}</strong>: ${m.text}<small>${new Date(m.timestamp).toLocaleTimeString()}</small>`;
  if(m.uid===currentUser?.uid){
    const btn=document.createElement("button");
    btn.textContent="üóë";
    btn.className="deleteBtn";
    btn.onclick=()=>deleteMsg(key);
    div.appendChild(btn);
  }
  chatWindow.appendChild(div);
  chatWindow.scrollTop=chatWindow.scrollHeight;
  if(m.uid!==currentUser?.uid){ msgSound.currentTime=0; msgSound.play(); alert(`Nova mensagem de ${m.user}`); }
}

// ENVIAR
sendBtn.onclick=sendMsg;
msgInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMsg();});
function sendMsg(){
  if(!currentUser) return;
  const text=msgInput.value.trim();
  if(!text) return;
  db.ref(currentChat).push({
    uid:currentUser.uid,
    user:currentUser.displayName,
    text,
    timestamp:Date.now()
  });
  msgInput.value="";
}

// APAGAR (somente autor)
function deleteMsg(key){
  if(!currentUser) return;
  db.ref(currentChat+"/"+key).once("value",snap=>{
    const val=snap.val();
    if(val && val.uid===currentUser.uid){
      db.ref(currentChat+"/"+key).remove();
      chatWindow.innerHTML="";
      chatListener.off();
      chatListener.on("child_added",snap=>renderMsg(snap.key,snap.val()));
    } else {
      alert("Voc√™ s√≥ pode apagar suas pr√≥prias mensagens.");
    }
  });
}

// BOT√ÉO GERAL
generalBtn.onclick=openGlobal;
</script>

</body>
</html>
