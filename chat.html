<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>—á–∞—Ç üåç</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-bg-dark: #1e1e1e;
  --color-text-light: #333;
  --color-text-dark: #eee;
  --color-primary: #4CAF50;
  --color-primary-hover: #45a049;
}

/* ===== RESET ===== */
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height: 100%; font-family: Arial, sans-serif; background: var(--color-bg-light); }

/* ===== HEADER ===== */
header {
  background:#fff;
  padding:10px;
  border-bottom:1px solid #ddd;
}
header h1 {
  display:flex;
  align-items:center;
  gap:8px;
  color: var(--color-primary);
  font-size:1.4em;
}
.emoji-head { width:32px; height:32px; vertical-align:middle; }

/* ===== TOPBAR ===== */
#topBar {
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  background:#fafafa;
  border-bottom:1px solid #ddd;
  overflow-x:auto;
  flex-wrap:wrap;
}
#topBar button {
  background:white;
  color:var(--color-primary);
  border:1px solid var(--color-primary);
  padding:6px 10px;
  border-radius:5px;
  cursor:pointer;
  flex-shrink:0;
}
#topBar span { font-size:0.9em; flex-shrink:0; }

/* ===== MOBILE USER LINE ===== */
#mobileUserLine {
  display:none;
  overflow-x:auto;
  white-space:nowrap;
  background:#fafafa;
  padding:6px 4px;
  border-bottom:1px solid #ddd;
  scroll-behavior: smooth;
}
.userItemMobile {
  width:50px;
  height:50px;
  border-radius:50%;
  overflow:hidden;
  cursor:pointer;
  display:inline-block;
  margin-right:6px;
  border:2px solid transparent;
  flex-shrink:0;
  transition: transform 0.2s;
}
.userItemMobile img { width:100%; height:100%; border-radius:50%; object-fit:cover; }
.userItemMobile:hover { border-color:var(--color-primary); transform:scale(1.1); }

/* ===== MAIN CONTENT ===== */
#mainContent { display:flex; flex:1; overflow:hidden; height: calc(100vh - 108px); }

/* ===== USER LIST (DESKTOP) ===== */
#userList {
  width:200px;
  background:#fff;
  border-right:1px solid #ddd;
  overflow-y:auto;
  padding:8px;
}
.userItem {
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:6px;
  cursor:pointer;
  padding:6px;
  border-radius:5px;
}
.userItem:hover { background:#e0f7e9; }
.userItem img { width:28px; height:28px; border-radius:50%; }

/* ===== CHAT ===== */
#chatContainer { flex:1; display:flex; flex-direction:column; overflow:hidden; }
#chatWindow {
  flex:1;
  overflow-y:auto;
  padding:10px;
  background:white;
}
.msg {
  margin:5px 0;
  padding:8px;
  border-radius:8px;
  max-width:80%;
  word-wrap:break-word;
}
.userMsg { background:#e0f7e9; align-self:flex-end; }
.otherMsg { background:#fff8dc; align-self:flex-start; }

/* ===== CHAT INPUT ===== */
#chatInput {
  display:flex;
  border-top:1px solid #ddd;
  background:white;
  padding:4px;
}
#chatInput input {
  flex:1;
  padding:10px;
  font-size:1em;
  border:1px solid #ccc;
  border-radius:5px;
}
#chatInput button {
  background:var(--color-primary);
  color:white;
  border:none;
  padding:10px 14px;
  margin-left:4px;
  border-radius:5px;
  cursor:pointer;
}
#chatInput button:hover { background:var(--color-primary-hover); }

/* ===== ADS ===== */
#adSidebar {
  width:280px;
  background:#f1f1f1;
  border-left:1px dashed #ccc;
  padding:8px;
  text-align:center;
  overflow-y:auto;
}

/* ===== FOOTER ===== */
footer {
  background:white;
  color:#555;
  text-align:center;
  padding:6px;
  font-size:0.85em;
  border-top:1px solid #ddd;
}

/* ===== MOBILE ===== */
@media(max-width:768px){
  #mainContent { flex-direction:column; height: calc(100vh - 140px); }
  #userList, #adSidebar { display:none; }
  #mobileUserLine { display:flex; }
  #chatWindow { flex:1; overflow-y:auto; margin-bottom:60px; }
  #chatInput { position:fixed; bottom:0; left:0; right:0; padding:4px; background:white; z-index:50; display:flex; width:100%; }
  footer { position:fixed; bottom:-1px; left:0; right:0; }
  html, body { overflow:hidden; }
  #topBar { position:fixed; top:52px; left:0; right:0; z-index:100; }
}
</style>
</head>

<body>
<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
</header>

<div id="topBar">
  <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
  <button id="loginBtn">Login com Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
  <button id="generalBtn" style="display:none;">‚¨Ö Bate-papo geral</button>
  <span id="alertaLogin">‚ö†Ô∏è Fa√ßa login para enviar mensagens.</span>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<!-- Linha de usu√°rios online para mobile -->
<div id="mobileUserLine"></div>

<div id="mainContent">
  <div id="userList"></div>

  <div id="chatContainer">
    <div id="chatWindow"></div>
    <div id="chatInput">
      <input type="text" id="msgInput" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>

  <div id="adSidebar">Publicidade aqui (Adsense)</div>
</div>

<footer>¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s com divers√£o!</footer>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
  authDomain: "dimitry-rusian.firebaseapp.com",
  databaseURL: "https://dimitry-rusian-default-rtdb.firebaseio.com",
  projectId: "dimitry-rusian",
  storageBucket: "dimitry-rusian.appspot.com",
  messagingSenderId: "449029666805",
  appId: "1:449029666805:web:feaf575a7b7e6f234a52bc"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const msgInput=document.getElementById("msgInput");
const sendBtn=document.getElementById("sendBtn");
const chatWindow=document.getElementById("chatWindow");
const userList=document.getElementById("userList");
const alertaLogin=document.getElementById("alertaLogin");
const onlineCount=document.getElementById("onlineCount");
const generalBtn=document.getElementById("generalBtn");
const mobileUserLine=document.getElementById("mobileUserLine");
let currentChat="global";

// Login/logout
loginBtn.onclick = ()=> auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick = ()=> auth.signOut();

// Estado do usu√°rio
auth.onAuthStateChanged(user=>{
  if(user){
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    alertaLogin.style.display="none";
    msgInput.disabled=false;
    sendBtn.disabled=false;
    db.ref("online/"+user.uid).set({name:user.displayName,photo:user.photoURL});
    db.ref("online/"+user.uid).onDisconnect().remove();
  } else{
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    alertaLogin.style.display="inline-block";
    msgInput.disabled=true;
    sendBtn.disabled=true;
  }
});

// Atualizar lista de usu√°rios online
db.ref("online").on("value", snap=>{
  const users=snap.val()||{};
  onlineCount.textContent=`üë• ${Object.keys(users).length}`;

  // Desktop
  userList.innerHTML="";
  for(const [uid,u] of Object.entries(users)){
    const div=document.createElement("div");
    div.className="userItem";
    div.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}"><span>${u.name}</span>`;
    div.onclick=()=>requestPrivateChat(uid,u.name);
    userList.appendChild(div);
  }

  // Mobile
  mobileUserLine.innerHTML="";
  for(const [uid,u] of Object.entries(users)){
    const div=document.createElement("div");
    div.className="userItemMobile";
    div.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" title="${u.name}">`;
    div.onclick=()=>requestPrivateChat(uid,u.name);
    mobileUserLine.appendChild(div);
  }
});

// Enviar mensagem
sendBtn.onclick = sendMessage;
msgInput.addEventListener("keypress", e=>{if(e.key==="Enter") sendMessage();});
function sendMessage(){
  const text=msgInput.value.trim();
  const user=auth.currentUser;
  if(!text||!user)return;
  const path=currentChat==="global"?"chatGlobal":"private/"+currentChat;
  db.ref(path).push({user:user.displayName,photo:user.photoURL,text,timestamp:Date.now()});
  msgInput.value="";
}

// Receber mensagens
db.ref("chatGlobal").on("child_added", snap=>showMessage(snap.val(),"chatGlobal"));
function showMessage(msg,room){
  if(room!=="chatGlobal" && room!==currentChat) return;
  const div=document.createElement("div");
  div.className=msg.user===auth.currentUser?.displayName?"msg userMsg":"msg otherMsg";
  div.textContent=`${msg.user}: ${msg.text}`;
  chatWindow.appendChild(div);
  chatWindow.scrollTop=chatWindow.scrollHeight;
}

// Chat privado
function requestPrivateChat(uid,name){
  if(!auth.currentUser) return alert("Fa√ßa login para conversar.");
  if(uid===auth.currentUser.uid) return;
  if(!confirm(`Deseja enviar um pedido de conversa privada para ${name}?`)) return;
  currentChat=[auth.currentUser.uid,uid].sort().join("_");
  chatWindow.innerHTML=`<div style='text-align:center;margin:10px;color:#555;'>üí¨ Conversa privada com ${name}</div>`;
  generalBtn.style.display="inline-block";
  db.ref("private/"+currentChat).off();
  db.ref("private/"+currentChat).on("child_added", s=>showMessage(s.val(),currentChat));
}

// Voltar ao chat geral
generalBtn.onclick=()=>{
  currentChat="global";
  chatWindow.innerHTML="";
  db.ref("chatGlobal").once("value",s=>{s.forEach(m=>showMessage(m.val(),"chatGlobal"));});
  generalBtn.style.display="none";
};
</script>
</body>
</html>
