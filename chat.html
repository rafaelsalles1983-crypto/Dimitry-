<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ß–∞—Ç ‚Äî Clube Eslavo</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- CSS -->
<link rel="stylesheet" href="chat.css">

<style>
body {
  font-family: Arial, sans-serif;
  background-color: var(--bg-color, #101010);
  color: var(--text-color, #fff);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
}

/* ===== TOPO ===== */
header {
  background: #1c1c1c;
  color: #fff;
  text-align: center;
  padding: 10px;
  position: relative;
}
header h1 { margin: 0; font-size: 20px; }
header button.voltar {
  position: absolute;
  left: 10px;
  top: 10px;
  background: #252525;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 6px 10px;
  cursor: pointer;
  transition: 0.3s;
}
header button.voltar:hover {
  background: #444;
}

/* ===== LAYOUT PRINCIPAL ===== */
main {
  display: flex;
  flex: 1;
  overflow: hidden;
  background: #181818;
}

/* ===== LISTA DE USU√ÅRIOS ONLINE ===== */
#userList {
  width: 220px;
  background: #202020;
  border-right: 2px solid #333;
  padding: 10px;
  overflow-y: auto;
  color: #ccc;
}
#userList h3 { text-align: center; margin-top: 0; }
.user-item { margin: 5px 0; padding: 5px; border-bottom: 1px solid #333; }

/* ===== JANELA DE CHAT ===== */
#chatContainer {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
#chatWindow {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}
.msg {
  margin: 5px 0;
  padding: 8px;
  border-radius: 10px;
  max-width: 75%;
  word-wrap: break-word;
}
.userMsg {
  background: #2a7bde;
  align-self: flex-end;
  color: #fff;
}
.otherMsg {
  background: #333;
  align-self: flex-start;
  color: #ddd;
}

/* ===== NOTIFICA√á√ÉO ===== */
#notification {
  background: #2a7bde;
  text-align: center;
  padding: 5px;
  font-size: 14px;
  display: none;
}

/* ===== CONTROLES ===== */
#controls {
  display: flex;
  align-items: center;
  background: #111;
  padding: 10px;
  gap: 10px;
}
#msgInput {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: none;
}
button {
  background: #2a7bde;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 8px 12px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { background: #155fa0; }
button.apagar { background: #d63b3b; }
button.apagar:hover { background: #a82626; }
button.bloquear { background: #f1b41c; color: #111; }
button.bloquear:hover { background: #e29c00; }

/* ===== RODAP√â ===== */
footer {
  text-align: center;
  background: #1c1c1c;
  padding: 10px;
  font-size: 14px;
  color: #888;
}

/* ===== MOBILE ===== */
@media (max-width: 768px) {
  main { flex-direction: column; }
  #userList {
    order: 2;
    width: 100%;
    border: none;
    border-top: 2px solid #333;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  footer {
    position: fixed;
    bottom: 0;
    width: 100%;
  }
}
</style>
</head>

<body>
<header>
  <button class="voltar" onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
  <h1>üí¨ Bate-papo em Grupo</h1>
</header>

<div id="notification"></div>

<main>
  <aside id="userList">
    <h3>Usu√°rios Online</h3>
    <div id="onlineUsers"></div>
  </aside>

  <section id="chatContainer">
    <div id="chatWindow"></div>
    <div id="controls">
      <input id="msgInput" type="text" placeholder="Digite sua mensagem...">
      <button id="sendBtn">Enviar</button>
      <button class="apagar" id="apagarBtn">Apagar</button>
      <button class="bloquear" id="bloquearBtn">Bloquear</button>
    </div>
  </section>
</main>

<footer>¬© Clube Eslavo ‚Äî Chat em grupo</footer>

<audio id="msgSound" src="https://assets.mixkit.co/sfx/download/mixkit-positive-notification-951.wav"></audio>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "seu-projeto.firebaseapp.com",
  databaseURL: "https://seu-projeto-default-rtdb.firebaseio.com",
  projectId: "seu-projeto",
  storageBucket: "seu-projeto.appspot.com",
  messagingSenderId: "000000000000",
  appId: "1:000000000000:web:000000000000"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===== LOGIN AN√îNIMO ===== */
firebase.auth().signInAnonymously();

/* ===== VARI√ÅVEIS ===== */
const chatWindow = document.getElementById('chatWindow');
const msgInput = document.getElementById('msgInput');
const sendBtn = document.getElementById('sendBtn');
const apagarBtn = document.getElementById('apagarBtn');
const bloquearBtn = document.getElementById('bloquearBtn');
const onlineUsersDiv = document.getElementById('onlineUsers');
const notification = document.getElementById('notification');
const msgSound = document.getElementById('msgSound');
let blocked = false;
let userId = null;
let username = "Usu√°rio";

/* ===== LOGIN USU√ÅRIO ===== */
firebase.auth().onAuthStateChanged(user => {
  if (user) {
    userId = user.uid;
    username = "Usu√°rio_" + user.uid.substring(0, 5);
    db.ref("onlineUsers/" + userId).set(username);
    db.ref("onlineUsers/" + userId).onDisconnect().remove();
  }
});

/* ===== USU√ÅRIOS ONLINE ===== */
db.ref("onlineUsers").on("value", snap => {
  onlineUsersDiv.innerHTML = "";
  snap.forEach(u => {
    const div = document.createElement("div");
    div.className = "user-item";
    div.textContent = u.val();
    onlineUsersDiv.appendChild(div);
  });
});

/* ===== RECEBER MENSAGENS ===== */
db.ref("messages").on("child_added", snap => {
  const msg = snap.val();
  const div = document.createElement("div");
  div.className = "msg " + (msg.userId === userId ? "userMsg" : "otherMsg");
  div.textContent = `${msg.username}: ${msg.text}`;
  div.dataset.id = snap.key;

  // bot√£o apagar individual (somente autor)
  if (msg.userId === userId) {
    const delBtn = document.createElement("button");
    delBtn.textContent = "√ó";
    delBtn.style.marginLeft = "10px";
    delBtn.style.background = "transparent";
    delBtn.style.border = "none";
    delBtn.style.color = "#fff";
    delBtn.style.cursor = "pointer";
    delBtn.onclick = () => db.ref("messages/" + snap.key).remove();
    div.appendChild(delBtn);
  }

  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;

  if (msg.userId !== userId) {
    msgSound.play();
    document.title = "üí¨ Nova mensagem!";
    notification.style.display = "block";
    notification.textContent = `${msg.username} enviou uma mensagem`;
    setTimeout(() => {
      document.title = "–ß–∞—Ç ‚Äî Clube Eslavo";
      notification.style.display = "none";
    }, 4000);
  }
});

/* ===== APAGAR TODAS AS MENSAGENS DO USU√ÅRIO ===== */
apagarBtn.onclick = () => {
  db.ref("messages").once("value", snap => {
    snap.forEach(child => {
      if (child.val().userId === userId) db.ref("messages/" + child.key).remove();
    });
  });
};

/* ===== BLOQUEAR ===== */
bloquearBtn.onclick = () => {
  blocked = !blocked;
  bloquearBtn.textContent = blocked ? "Desbloquear" : "Bloquear";
};

/* ===== ENVIAR MENSAGEM ===== */
function sendMessage() {
  if (blocked) return;
  const text = msgInput.value.trim();
  if (!text) return;
  db.ref("messages").push({
    userId,
    username,
    text,
    time: Date.now()
  });
  msgInput.value = "";
}
sendBtn.onclick = sendMessage;
msgInput.addEventListener("keypress", e => {
  if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
