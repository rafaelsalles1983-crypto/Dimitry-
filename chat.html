<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>—á–∞—Ç üåç</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-primary: #4CAF50;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:Arial, sans-serif; background:var(--color-bg-light); transition:background 0.3s, color 0.3s; }

body.dark { background:#121212; color:#eee; }
body.dark header, body.dark footer, body.dark #chatContainer, body.dark #userList, body.dark #adSidebar, body.dark #chatInput { background:#1e1e1e; color:#eee; border-color:#333; }
body.dark #topBar { background:#1a1a1a; border-color:#333; }
body.dark #chatInput input { background:#333; color:#eee; border:1px solid #555; }
body.dark #chatInput button { background:#388e3c; }
body.dark .userMsg { background:#2e7d32; color:white; }
body.dark .otherMsg { background:#3e3e3e; color:white; }

/* HEADER */
header { background:#fff; padding:10px; border-bottom:1px solid #ddd; display:flex; align-items:center; gap:8px; position:fixed; top:0; left:0; right:0; z-index:10; justify-content:space-between; }
header h1 { color:var(--color-primary); font-size:1.3em; display:flex; align-items:center; gap:6px; }
.emoji-head { width:28px; }

/* LANGUAGE + THEME BTNS */
#langThemeBtns { display:flex; gap:8px; align-items:center; }
#langThemeBtns button { background:white; color:var(--color-primary); border:1px solid var(--color-primary); border-radius:5px; padding:4px 10px; cursor:pointer; font-size:0.9em; }
#langThemeBtns button:hover { background:var(--color-primary); color:white; }
body.dark #langThemeBtns button { background:#333; color:#a5d6a7; border-color:#4CAF50; }

/* TOPBAR */
#topBar { display:flex; gap:8px; padding:8px; background:#fafafa; border-bottom:1px solid #ddd; margin-top:50px; flex-wrap:wrap; justify-content:space-between; align-items:center; }
#topBar .left { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
#topBar button { background:white; color:var(--color-primary); border:1px solid var(--color-primary); border-radius:5px; padding:6px 10px; cursor:pointer; }
#topBar button:hover { background:var(--color-primary); color:white; }
#topBar span { font-size:0.9em; }

/* MAIN */
#mainContent { display:flex; height:calc(100vh - 130px); }
#userList { width:200px; background:white; border-right:1px solid #ddd; overflow-y:auto; padding-bottom:10px; }
.userItem { display:flex; align-items:center; gap:6px; padding:6px; cursor:pointer; border-radius:5px; margin:4px; }
.userItem:hover { background:#e8f8ee; }
.userItem img { width:28px; height:28px; border-radius:50%; }

/* CHAT */
#chatContainer { flex:1; display:flex; flex-direction:column; background:white; border-left:1px solid #ddd; }
#chatHeader { padding:6px; background:#fafafa; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center; }
#chatHeader h2 { font-size:1em; color:#333; }
#chatWindow { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:6px; }
.msg { margin:0; padding:8px; border-radius:8px; max-width:80%; word-wrap:break-word; position:relative; }
.userMsg { background:#e0f7e9; align-self:flex-end; text-align:right; }
.otherMsg { background:#fff8dc; align-self:flex-start; text-align:left; }
.msg small { display:block; font-size:0.7em; color:#666; margin-top:6px; }

/* DELETE BUTTON */
.deleteBtn { position:absolute; bottom:6px; right:6px; background:transparent; border:none; color:#c00; cursor:pointer; font-size:0.9em; display:none; padding:2px; }
.msg:hover .deleteBtn { display:inline; }

/* INPUT */
#chatInput { display:flex; border-top:1px solid #ddd; background:white; padding:6px; }
#chatInput input { flex:1; padding:10px; border:1px solid #ccc; border-radius:6px; outline:none; }
#chatInput button { background:var(--color-primary); color:white; border:none; padding:10px 15px; margin-left:8px; border-radius:6px; cursor:pointer; }

/* ADS */
#adSidebar { width:250px; background:#f7f7f7; border-left:1px dashed #ccc; text-align:center; padding:8px; }

/* FOOTER */
footer { background:white; text-align:center; padding:6px; border-top:1px solid #ddd; font-size:0.85em; position:fixed; bottom:0; left:0; right:0; z-index:20; }

/* NOTIF */
#notificationContainer { position:fixed; top:70px; right:10px; display:flex; flex-direction:column; gap:10px; z-index:200; width:260px; }
.notification { background:#4CAF50; color:white; padding:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); display:flex; justify-content:space-between; align-items:center; gap:8px; }
.notification b { font-weight:700; }
.notification button { background:transparent; border:none; color:white; cursor:pointer; font-size:1.1em; }

/* MOBILE */
@media(max-width:768px){
  #mainContent { flex-direction:column; height:auto; }
  #adSidebar { display:none; }
  #userList { width:100%; order:-1; display:flex; overflow-x:auto; border-bottom:1px solid #ddd; padding:6px; gap:6px; }
  .userItem { flex:0 0 auto; margin:0; padding:4px; background:#fff; border-radius:6px; }
  footer { display:none; }
  #chatContainer { height:calc(100vh - 200px); }
  #chatInput { position:fixed; bottom:0; left:0; right:0; padding:8px; z-index:30; background:rgba(255,255,255,0.98); }
  #chatWindow { padding-bottom:80px; }
}
</style>
</head>
<body>

<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
  <div id="langThemeBtns">
    <button id="themeBtn">üåô</button>
    <button id="langBtn">üá∑üá∫ –†—É—Å</button>
  </div>
</header>

<div id="topBar">
  <div class="left">
    <button id="homeBtn" onclick="location.href='index.html'">üè† In√≠cio</button>
    <button id="loginBtn">Login com Google</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="generalBtn" style="display:none;">üí¨ Bate-papo Geral</button>
  </div>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<div id="mainContent">
  <div id="userList"></div>
  <div id="chatContainer">
    <div id="chatHeader">
      <h2 id="chatTitle">üí¨ Bate-papo Geral</h2>
    </div>
    <div id="chatWindow"></div>
    <div id="chatInput">
      <input id="msgInput" type="text" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>
  <div id="adSidebar">Publicidade (Adsense)</div>
</div>

<footer id="footer">¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s</footer>
<div id="notificationContainer"></div>
<audio id="msgSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a8c4e8d5a.mp3?filename=message-pop-alert-23584.mp3" preload="auto"></audio>

<script>
/* ===== TEMAS ===== */
const themeBtn=document.getElementById('themeBtn');
themeBtn.onclick=()=>{document.body.classList.toggle('dark'); themeBtn.textContent=document.body.classList.contains('dark')?'‚òÄÔ∏è':'üåô';};

/* ===== IDIOMA ===== */
const langBtn=document.getElementById('langBtn');
let currentLang='ru';
const texts={
  ru:{siteName:"–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–±",homeBtn:"üè† –ì–ª–∞–≤–Ω–∞—è",loginBtn:"–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google",logoutBtn:"–í—ã–π—Ç–∏",chatBtn:"üí¨ –û–±—â–∏–π —á–∞—Ç",usersOnline:"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–Ω–ª–∞–π–Ω: ",msgPlaceholder:"–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",sendBtn:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å",footer:"¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî –£—á–∏—Ç–µ —Ä—É—Å—Å–∫–∏–π –∏ –ø–æ—Ä—Ç—É–≥–∞–ª—å—Å–∫–∏–π",chatTitle:"üí¨ –û–±—â–∏–π —á–∞—Ç"},
  pt:{siteName:"–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–±",homeBtn:"üè† In√≠cio",loginBtn:"Login com Google",logoutBtn:"Logout",chatBtn:"üí¨ Bate-papo Geral",usersOnline:"üë• Usu√°rios online: ",msgPlaceholder:"Digite sua mensagem...",sendBtn:"Enviar",footer:"¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s",chatTitle:"üí¨ Bate-papo Geral"}
};
function updateTexts(lang){
  document.querySelector('header h1').childNodes[0].nodeValue = texts[lang].siteName+" ";
  document.getElementById('homeBtn').textContent = texts[lang].homeBtn;
  document.getElementById('loginBtn').textContent = texts[lang].loginBtn;
  document.getElementById('logoutBtn').textContent = texts[lang].logoutBtn;
  document.getElementById('generalBtn').textContent = texts[lang].chatBtn;
  document.getElementById('onlineCount').textContent = texts[lang].usersOnline + (parseInt(document.getElementById('onlineCount').textContent.replace(/\D/g,''))||0);
  document.getElementById('msgInput').placeholder = texts[lang].msgPlaceholder;
  document.getElementById('sendBtn').textContent = texts[lang].sendBtn;
  document.getElementById('footer').textContent = texts[lang].footer;
  document.getElementById('chatTitle').textContent = texts[lang].chatTitle;
}
langBtn.onclick = ()=>{
  currentLang = currentLang==='ru'?'pt':'ru';
  langBtn.textContent = currentLang==='ru'?'üá∑üá∫ –†—É—Å':'üáßüá∑ PT';
  document.documentElement.lang = currentLang==='ru'?'ru':'pt-BR';
  updateTexts(currentLang);
};
updateTexts(currentLang);

/* ===== FIREBASE E CHAT ===== */
const firebaseConfig={
  apiKey:"AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
  authDomain:"dimitry-rusian.firebaseapp.com",
  databaseURL:"https://dimitry-rusian-default-rtdb.firebaseio.com",
  projectId:"dimitry-rusian",
  storageBucket:"dimitry-rusian.appspot.com",
  messagingSenderId:"449029666805",
  appId:"1:449029666805:web:feaf575a7b7e6f234a52bc"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database();

const loginBtnEl=document.getElementById('loginBtn'), logoutBtnEl=document.getElementById('logoutBtn'), generalBtnEl=document.getElementById('generalBtn');
const userList=document.getElementById('userList'), msgInput=document.getElementById('msgInput'), sendBtn=document.getElementById('sendBtn');
const chatWindow=document.getElementById('chatWindow'), chatTitle=document.getElementById('chatTitle'), onlineCount=document.getElementById('onlineCount');
const notificationContainer=document.getElementById('notificationContainer'), msgSound=document.getElementById('msgSound');
let currentUser=null, currentChat='chatGlobal', activeListener=null;

// LOGIN GOOGLE COM TRATAMENTO DE ERROS
loginBtnEl.onclick = () => {
  const provider = new firebase.auth.GoogleAuth
