<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>—á–∞—Ç üåç</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-primary: #4CAF50;
  --color-primary-hover: #45a049;
  --color-name: #1976d2;
}
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; font-family:Arial,sans-serif; background: var(--color-bg-light); }

header {
  background:#fff; padding:10px; border-bottom:1px solid #ddd;
  z-index:100; display:flex; align-items:center; gap:8px; justify-content:space-between;
}
header h1 { display:flex; align-items:center; gap:8px; color: var(--color-primary); font-size:1.4em; }
.emoji-head { width:32px; height:32px; }

#topBar {
  display:flex; align-items:center; gap:8px; padding:6px 10px;
  background:#fafafa; border-bottom:1px solid #ddd; flex-wrap:wrap; overflow-x:auto;
}
#topBar button { background:white; color:var(--color-primary); border:1px solid var(--color-primary); padding:6px 10px; border-radius:5px; cursor:pointer; flex-shrink:0; }
#topBar span { font-size:0.9em; flex-shrink:0; }

#mobileUserLine {
  display:none; overflow-x:hidden; white-space:nowrap; background:#fafafa;
  padding:6px 4px; border-bottom:1px solid #ddd;
}
.userItemMobile {
  width:50px; height:50px; border-radius:50%; overflow:hidden; display:inline-block;
  margin-right:6px; border:2px solid transparent; cursor:pointer; transition: transform 0.2s;
  position:relative;
}
.userItemMobile img { width:100%; height:100%; border-radius:50%; object-fit:cover; }
.userItemMobile:hover { border-color:var(--color-primary); transform:scale(1.1); }

.alert-dot { position:absolute; top:0; right:0; width:12px; height:12px; background:red; border-radius:50%; animation: blink 1s infinite; }
@keyframes blink { 50% { opacity:0; } }

#currentPartner { font-weight:bold; color: var(--color-name); }

#mainContent { display:flex; flex:1; overflow:hidden; height: calc(100vh - 108px); }

#userList { width:200px; background:#fff; border-right:1px solid #ddd; overflow-y:auto; padding:8px; }
.userItem { display:flex; align-items:center; gap:6px; margin-bottom:6px; cursor:pointer; padding:6px; border-radius:5px; position:relative; }
.userItem:hover { background:#e0f7e9; }
.userItem img { width:28px; height:28px; border-radius:50%; }

#chatContainer { flex:1; display:flex; flex-direction:column; overflow:hidden; position:relative; }
#chatHeader { display:flex; justify-content:space-between; align-items:center; padding:6px 10px; border-bottom:1px solid #ddd; background:#fafafa; position:relative; gap:4px; }
#chatHeader .chatHeaderButtons { display:flex; gap:6px; }
#chatWindow { flex:1; overflow-y:auto; padding:6px; background:white; }

.msg { margin:4px 0; padding:6px; border-radius:8px; max-width:80%; word-wrap:break-word; }
.userMsg { background:#e0f7e9; align-self:flex-end; text-align:right; }
.otherMsg { background:#fff8dc; align-self:flex-start; text-align:left; }

#chatInput { display:flex; border-top:1px solid #ddd; background:white; padding:4px; }
#chatInput input { flex:1; padding:8px; font-size:1em; border:1px solid #ccc; border-radius:5px; }
#chatInput button { background:var(--color-primary); color:white; border:none; padding:8px 12px; margin-left:4px; border-radius:5px; cursor:pointer; }
#chatInput button:hover { background:var(--color-primary-hover); }

#adSidebar { width:280px; background:#f1f1f1; border-left:1px dashed #ccc; padding:8px; text-align:center; overflow-y:auto; }

footer { background:white; color:#555; text-align:center; padding:6px; font-size:0.85em; border-top:1px solid #ddd; }

.mobileControlArea {
  display:none;
  position:fixed;
  bottom:100px;
  left:0;
  right:0;
  background:white;
  padding:8px 4px;
  display:flex;
  gap:4px;
  z-index:80;
}
.mobileControlArea button {
  flex:1;
  padding:10px;
  font-size:0.9em;
  border:none;
  border-radius:5px;
  cursor:pointer;
  opacity:0.95;
}
#hideChatBtnMobile { background:red; color:white; }
#blockBtnMobile { background:var(--color-primary); color:white; }

@media(max-width:768px){
  header { position:fixed; top:0; left:0; right:0; z-index:100; height:50px; }
  #topBar { position:fixed; top:50px; left:0; right:0; height:40px; z-index:100; }
  #mobileUserLine { display:flex; position:fixed; top:90px; left:0; right:0; padding:6px 4px; background:#fafafa; border-bottom:1px solid #ddd; z-index:100; overflow-x:auto; white-space:nowrap; }
  #mainContent { flex-direction:column; margin-top:140px; margin-bottom:120px; height:auto; overflow-y:auto; }
  #chatWindow { flex:1; overflow-y:auto; width:100%; padding-bottom:150px; }
  #chatInput { position:fixed; bottom:50px; left:0; right:0; background:white; z-index:70; width:100%; }
  .mobileControlArea { display:flex; bottom:100px; }
  footer { position:fixed; bottom:0; left:0; right:0; height:40px; z-index:90; }
  #userList, #adSidebar { display:none; }
}
</style>
</head>
<body>

<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
</header>

<div id="topBar">
  <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
  <button id="loginBtn">Login com Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
  <button id="generalBtn" style="display:none;">‚¨Ö Bate-papo geral</button>
  <span id="alertaLogin">‚ö†Ô∏è Fa√ßa login para enviar mensagens.</span>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<div id="mobileUserLine"></div>

<div id="mainContent">
  <div id="userList"></div>
  <div id="chatContainer">
    <div id="chatHeader">
      <div id="currentPartner">üåç Global</div>
      <div class="chatHeaderButtons">
        <button id="hideChatBtn" style="display:none;">Apagar chat</button>
        <button id="blockBtn" style="display:none;">Bloquear</button>
      </div>
    </div>

    <div id="chatWindow"></div>

    <div class="mobileControlArea">
      <button id="hideChatBtnMobile">Apagar chat</button>
      <button id="blockBtnMobile">Bloquear</button>
    </div>

    <div id="chatInput">
      <input type="text" id="msgInput" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>
  <div id="adSidebar">Publicidade aqui (Adsense)</div>
</div>

<footer>¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s com divers√£o!</footer>

<script>
/* ========== FIREBASE CONFIG ========== */
const firebaseConfig={apiKey:"AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
authDomain:"dimitry-rusian.firebaseapp.com",
databaseURL:"https://dimitry-rusian-default-rtdb.firebaseio.com",
projectId:"dimitry-rusian",
storageBucket:"dimitry-rusian.appspot.com",
messagingSenderId:"449029666805",
appId:"1:449029666805:web:feaf575a7b7e6f234a52bc"};
firebase.initializeApp(firebaseConfig);

/* ========== VARI√ÅVEIS GLOBAIS ========== */
const auth=firebase.auth(),db=firebase.database();
const loginBtn=document.getElementById("loginBtn"),logoutBtn=document.getElementById("logoutBtn"),
msgInput=document.getElementById("msgInput"),sendBtn=document.getElementById("sendBtn"),
chatWindow=document.getElementById("chatWindow"),userList=document.getElementById("userList"),
alertaLogin=document.getElementById("alertaLogin"),onlineCount=document.getElementById("onlineCount"),
generalBtn=document.getElementById("generalBtn"),mobileUserLine=document.getElementById("mobileUserLine"),
currentPartnerEl=document.getElementById("currentPartner"),hideChatBtn=document.getElementById("hideChatBtn"),
blockBtn=document.getElementById("blockBtn"),hideChatBtnMobile=document.getElementById("hideChatBtnMobile"),
blockBtnMobile=document.getElementById("blockBtnMobile");

let currentChat="chatGlobal",privateChatListener=null,alertIcons={},userData={},currentPartnerUID=null,blockedUsers={},hiddenChats={};

/* ========== LOGIN E LOGOUT ========== */
loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(user=>{
  if(user){
    loginBtn.style.display="none"; logoutBtn.style.display="inline-block";
    alertaLogin.style.display="none"; msgInput.disabled=false; sendBtn.disabled=false;
    userData={uid:user.uid,name:user.displayName,photo:user.photoURL};
    db.ref("online/"+user.uid).set({name:user.displayName,photo:user.photoURL});
    db.ref("online/"+user.uid).onDisconnect().remove();
    loadBlockedUsers().then(updateUserList);
    startGlobalChat();
  } else {
    loginBtn.style.display="inline-block"; logoutBtn.style.display="none";
    alertaLogin.style.display="inline-block"; msgInput.disabled=true; sendBtn.disabled=true;
    userData={}; currentPartnerUID=null;
    updateUserList(); startGlobalChat();
  }
});

/* ========== BLOQUEIO ========== */
async function loadBlockedUsers(){
  if(!userData.uid)return;
  const snap=await db.ref(`blocked/${userData.uid}`).once("value");
  blockedUsers=snap.val()||{};
}

function toggleBlock(){
  if(!currentPartnerUID||!userData.uid)return;
  const ref=db.ref(`blocked/${userData.uid}/${currentPartnerUID}`);
  if(blockedUsers[currentPartnerUID]){
    ref.remove(); blockedUsers[currentPartnerUID]=false;
    blockBtn.textContent=blockBtnMobile.textContent="Bloquear"; alert("Usu√°rio desbloqueado.");
  }else{
    ref.set(true); blockedUsers[currentPartnerUID]=true;
    blockBtn.textContent=blockBtnMobile.textContent="Desbloquear"; alert("Usu√°rio bloqueado.");
  }
}
blockBtn.onclick=toggleBlock; blockBtnMobile.onclick=toggleBlock;

/* ========== LISTA DE USU√ÅRIOS ========== */
function updateUserList(){
  db.ref("online").once("value").then(snap=>{
    const users=snap.val()||{};
    userList.innerHTML=""; mobileUserLine.innerHTML=""; alertIcons={};

    const globalDiv=document.createElement("div");
    globalDiv.className="userItem"; globalDiv.innerHTML=`<img src="https://cdn-icons-png.flaticon.com/512/3126/3126540.png"><span>Global</span>`;
    globalDiv.onclick=startGlobalChat; userList.appendChild(globalDiv);
    const mobGlobal=globalDiv.cloneNode(true);
    mobGlobal.className="userItemMobile"; mobileUserLine.appendChild(mobGlobal);

    for(const [uid,u] of Object.entries(users)){
      if(uid===userData.uid)continue;
      const div=document.createElement("div");
      div.className="userItem";
      div.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}"><span>${u.name}</span>`;
      div.onclick=()=>startPrivateChat(uid,u.name);
      userList.appendChild(div);

      const mob=document.createElement("div");
      mob.className="userItemMobile";
      mob.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" title="${u.name}">`;
      mob.onclick=()=>startPrivateChat(uid,u.name);
      mobileUserLine.appendChild(mob);

      alertIcons[uid]={desktop:div,mobile:mob};
    }
    onlineCount.textContent=`üë• Usu√°rios online: ${Object.keys(users).length}`;
  });
}

/* ========== CHAT GLOBAL ========== */
function startGlobalChat(){
  currentChat="chatGlobal"; currentPartnerUID=null;
  currentPartnerEl.textContent="üåç Global";
  hideChatBtn.style.display=blockBtn.style.display="none";
  hideChatBtnMobile.style.display=blockBtnMobile.style.display="none";
  chatWindow.innerHTML="";
  db.ref("chatGlobal").once("value").then(snap=>{
    snap.forEach(m=>showMessage(m.val(),"chatGlobal"));
  });
}

/* ========== CHAT PRIVADO ========== */
function startPrivateChat(uid,name){
  currentPartnerUID=uid; currentChat=[userData.uid,uid].sort().join("_");
  currentPartnerEl.textContent=name; chatWindow.innerHTML="";
  hideChatBtn.style.display=blockBtn.style.display="inline-block";
  hideChatBtnMobile.style.display=blockBtnMobile.style.display="inline-block";
  blockBtn.textContent=blockBtnMobile.textContent=blockedUsers[uid]?"Desbloquear":"Bloquear";

  if(privateChatListener)privateChatListener.off();
  privateChatListener=db.ref("private/"+currentChat);
  privateChatListener.on("child_added",snap=>{
    const msg=snap.val(); showMessage(msg,currentChat);
  });
}

/* ========== ENVIAR MENSAGEM ========== */
sendBtn.onclick=sendMessage;
msgInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMessage();});
function sendMessage(){
  const text=msgInput.value.trim(); if(!text)return;
  if(currentPartnerUID && blockedUsers[currentPartnerUID]){alert("Voc√™ bloqueou este usu√°rio.");return;}
  const path=currentChat==="chatGlobal"?"chatGlobal":"private/"+currentChat;
  db.ref(path).push({user:userData.name,uid:userData.uid,text,timestamp:Date.now()});
  msgInput.value="";
}

/* ========== MOSTRAR MENSAGEM ========== */
function showMessage(msg,room){
  if(room!=="chatGlobal"&&room!==currentChat)return;
  const div=document.createElement("div");
  div.className=msg.uid===userData.uid?"msg userMsg":"msg otherMsg";
  div.textContent=msg.text;
  chatWindow.appendChild(div);
  chatWindow.scrollTop=chatWindow.scrollHeight;
}

/* ========== APAGAR CHAT (local) ========== */
function hideChat(){
  hiddenChats[currentChat]={};
  chatWindow.innerHTML="";
}
hideChatBtn.onclick=hideChat;
hideChatBtnMobile.onclick=hideChat;

/* Atualizar lista de usu√°rios */
setInterval(updateUserList,5000);
</script>
</body>
</html>
