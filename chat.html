<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>—á–∞—Ç üåç</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-primary: #4CAF50;
  --color-primary-hover: #45a049;
}

/* RESET */
* { box-sizing: border-box; margin:0; padding:0; }
html, body { height:100%; font-family:Arial,sans-serif; background: var(--color-bg-light); }

/* HEADER */
header { background:#fff; padding:10px; border-bottom:1px solid #ddd; z-index:100; display:flex; align-items:center; gap:8px; position:fixed; top:0; left:0; right:0; }
header h1 { display:flex; align-items:center; gap:8px; color: var(--color-primary); font-size:1.4em; }
.emoji-head { width:32px; height:32px; }

/* TOPBAR */
#topBar { display:flex; align-items:center; gap:8px; padding:6px 10px; background:#fafafa; border-bottom:1px solid #ddd; flex-wrap:wrap; overflow-x:auto; z-index:100; margin-top:50px;}
#topBar button { background:white; color:var(--color-primary); border:1px solid var(--color-primary); padding:6px 10px; border-radius:5px; cursor:pointer; flex-shrink:0; }
#topBar span { font-size:0.9em; flex-shrink:0; }

/* MOBILE USERS HORIZONTAL */
#mobileUserLine { display:flex; overflow-x:auto; white-space:nowrap; background:#fafafa; padding:6px 4px; border-bottom:1px solid #ddd; margin-top:0px; }
.userItemMobile { width:50px; height:50px; border-radius:50%; overflow:hidden; display:inline-block; margin-right:6px; border:2px solid transparent; cursor:pointer; transition: transform 0.2s; position:relative; }
.userItemMobile img { width:100%; height:100%; border-radius:50%; object-fit:cover; }
.userItemMobile:hover { border-color:var(--color-primary); transform:scale(1.1); }

/* BOLINHA DE NOTIFICA√á√ÉO PISCANTE */
.notify-dot { position:absolute; top:2px; right:2px; width:10px; height:10px; background:red; border-radius:50%; animation: blink 1s infinite; display:none; }
@keyframes blink { 0% { opacity:1; } 50% { opacity:0; } 100% { opacity:1; } }

/* MAIN */
#mainContent { display:flex; flex:1; overflow:hidden; height: calc(100vh - 150px); margin-top:10px; justify-content:center; }

/* USER LIST (DESKTOP) */
#userList { width:200px; background:#fff; border-right:1px solid #ddd; overflow-y:auto; padding:8px; }
.userItem { display:flex; align-items:center; gap:6px; margin-bottom:6px; cursor:pointer; padding:6px; border-radius:5px; position:relative; }
.userItem:hover { background:#e0f7e9; }
.userItem img { width:28px; height:28px; border-radius:50%; }

/* CHAT */
#chatContainer { flex:0 0 600px; display:flex; flex-direction:column; overflow:hidden; margin-left:0px; border:1px solid #ddd; border-radius:8px; background:white; }
#chatHeader { display:flex; justify-content:flex-end; gap:6px; padding:6px; border-bottom:1px solid #ddd; background:#fafafa; }
#chatHeader button { padding:6px 10px; border:none; border-radius:5px; cursor:pointer; color:white; background:var(--color-primary); }
#chatHeader button:hover { background:var(--color-primary-hover); }

#chatWindow { flex:1; overflow-y:auto; padding:10px; background:white; }
.msg { margin:5px 0; padding:8px; border-radius:8px; max-width:80%; word-wrap:break-word; }
.userMsg { background:#e0f7e9; align-self:flex-end; text-align:right; }
.otherMsg { background:#fff8dc; align-self:flex-start; text-align:left; }

/* CHAT INPUT */
#chatInput { display:flex; border-top:1px solid #ddd; background:white; padding:4px; }
#chatInput input { flex:1; padding:10px; font-size:1em; border:1px solid #ccc; border-radius:5px; }
#chatInput button { background:var(--color-primary); color:white; border:none; padding:10px 14px; margin-left:4px; border-radius:5px; cursor:pointer; }
#chatInput button:hover { background:var(--color-primary-hover); }

/* ADS */
#adSidebar { width:280px; background:#f1f1f1; border-left:1px dashed #ccc; padding:8px; text-align:center; overflow-y:auto; }

/* FOOTER */
footer { background:white; color:#555; text-align:center; padding:6px; font-size:0.85em; border-top:1px solid #ddd; position:fixed; bottom:0; left:0; right:0; z-index:100; }

/* MOBILE */
@media(max-width:768px){
  #mainContent { flex-direction:column; margin-top:130px; margin-bottom:100px; height:auto; }
  #chatContainer { width:100%; }
  #chatInput { position:fixed; bottom:40px; left:0; right:0; padding:4px; background:white; z-index:50; width:100%; }
  #userList, #adSidebar { display:none; }
}
</style>
</head>
<body>

<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
</header>

<div id="topBar">
  <button id="backBtn" onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
  <button id="loginBtn">Login com Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
  <span id="alertaLogin">‚ö†Ô∏è Fa√ßa login para enviar mensagens.</span>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<div id="mobileUserLine"></div>

<div id="mainContent">
  <div id="userList"></div>
  <div id="chatContainer">
    <div id="chatHeader">
      <button id="clearBtn">Apagar</button>
      <button id="blockBtn">Bloquear</button>
    </div>
    <div id="chatWindow"></div>
    <div id="chatInput">
      <input type="text" id="msgInput" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>
  <div id="adSidebar">Publicidade aqui (Adsense)</div>
</div>

<footer>¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s com divers√£o!</footer>

<audio id="msgSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a8c4e8d5a.mp3?filename=message-pop-alert-23584.mp3" preload="auto"></audio>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
  authDomain: "dimitry-rusian.firebaseapp.com",
  databaseURL: "https://dimitry-rusian-default-rtdb.firebaseio.com",
  projectId: "dimitry-rusian",
  storageBucket: "dimitry-rusian.appspot.com",
  messagingSenderId: "449029666805",
  appId: "1:449029666805:web:feaf575a7b7e6f234a52bc"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const chatWindow = document.getElementById("chatWindow");
const userList = document.getElementById("userList");
const alertaLogin = document.getElementById("alertaLogin");
const onlineCount = document.getElementById("onlineCount");
const mobileUserLine = document.getElementById("mobileUserLine");
const msgSound = document.getElementById("msgSound");
const clearBtn = document.getElementById("clearBtn");
const blockBtn = document.getElementById("blockBtn");

let blocked = false;
let knownUsers = {};
let currentUser = null;

// LOGIN/LOGOUT
loginBtn.onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(user=>{
  currentUser = user;
  if(user){
    knownUsers[user.uid] = {name:user.displayName, photo:user.photoURL};
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    alertaLogin.style.display = "none";
    msgInput.disabled = false;
    sendBtn.disabled = false;

    db.ref("online/"+user.uid).set({name:user.displayName, photo:user.photoURL});
    db.ref("online/"+user.uid).onDisconnect().remove();

    renderUserList();
    loadMessages();
  } else {
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    alertaLogin.style.display = "inline-block";
    msgInput.disabled = true;
    sendBtn.disabled = true;
    chatWindow.innerHTML = "";
    renderUserList();
  }
});

// RENDER USU√ÅRIOS ONLINE
function renderUserList(){
  db.ref("online").once("value").then(snap=>{
    const onlineUsers = snap.val()||{};
    onlineCount.textContent=`üë• ${Object.keys(onlineUsers).length} usu√°rios online`;

    const allUsers = {...knownUsers, ...onlineUsers};

    userList.innerHTML = "";
    mobileUserLine.innerHTML = "";

    for(const [uid,u] of Object.entries(allUsers)){
      const div = document.createElement("div");
      div.className="userItem";
      div.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}"><span>${u.name}</span>`;
      userList.appendChild(div);

      const mob = document.createElement("div");
      mob.className="userItemMobile";
      mob.innerHTML=`<img src="${u.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" title="${u.name}">`;
      mobileUserLine.appendChild(mob);
    }
  });
}

// ENVIAR MENSAGEM
sendBtn.onclick = sendMessage;
msgInput.addEventListener("keypress", e=>{ if(e.key==="Enter") sendMessage(); });

function sendMessage(){
  if(blocked) return;
  const text = msgInput.value.trim();
  if(!text || !currentUser) return;
  const msgData = {user:currentUser.displayName, photo:currentUser.photoURL, text, timestamp:Date.now()};
  db.ref("chatGlobal").push(msgData);
  msgInput.value="";
}

// CARREGAR MENSAGENS
function loadMessages(){
  db.ref("chatGlobal").off();
  db.ref("chatGlobal").on("child_added", snap=>{
    const msg = snap.val();
    const div = document.createElement("div");
    div.className = msg.user===currentUser?.displayName?"msg userMsg":"msg otherMsg";
    div.textContent = `${msg.user}: ${msg.text}`;
    chatWindow.appendChild(div);
    chatWindow.scrollTop = chatWindow.scrollHeight;
    msgSound.currentTime=0; msgSound.play();
  });
}

// APAGAR CHAT
clearBtn.onclick = ()=>{
  if(!confirm("Tem certeza que deseja apagar todas as mensagens?")) return;
  db.ref("chatGlobal").remove();
  chatWindow.innerHTML="";
};

// BLOQUEAR/DESBLOQUEAR
blockBtn.onclick = ()=>{
  blocked = !blocked;
  blockBtn.textContent = blocked ? "Desbloquear" : "Bloquear";
};

// CENTRALIZAR NO DESKTOP
window.addEventListener("resize", ()=>{
  document.getElementById("mainContent").style.justifyContent = window.innerWidth>768?"center":"flex-start";
});
</script>

</body>
</html>
