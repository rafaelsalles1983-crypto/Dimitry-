<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Club Eslavo 🌍</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --bg: #121212;
  --text: #fff;
  --accent: #00aaff;
  --input-bg: #1e1e1e;
  --msg-bg: #2a2a2a;
}
.light {
  --bg: #fafafa;
  --text: #222;
  --accent: #0077cc;
  --input-bg: #fff;
  --msg-bg: #f0f0f0;
}
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  height: 100vh;
}
header {
  background: var(--accent);
  color: white;
  padding: 10px;
  text-align: center;
  font-weight: bold;
}
#chat {
  flex: 1;
  display: flex;
  overflow: hidden;
}
#userList {
  width: 200px;
  background: var(--msg-bg);
  padding: 10px;
  overflow-y: auto;
}
#chatWindow {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  padding: 10px;
  overflow-y: auto;
}
#messages {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 5px;
}
.message {
  background: var(--msg-bg);
  padding: 8px 10px;
  margin-bottom: 8px;
  border-radius: 8px;
  word-wrap: break-word;
}
.message b { color: var(--accent); }
input, button {
  border: none;
  outline: none;
  padding: 10px;
  border-radius: 8px;
  font-size: 15px;
}
#inputArea {
  display: flex;
  gap: 8px;
}
#msgInput {
  flex: 1;
  background: var(--input-bg);
  color: var(--text);
}
button {
  background: var(--accent);
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
button:hover { opacity: 0.8; }

.notification {
  background: var(--accent);
  color: white;
  padding: 8px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
}
#controls {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  background: var(--msg-bg);
}
.translated {
  display: block;
  margin-top: 5px;
  font-size: 0.9em;
  color: #bbb;
}
</style>
</head>
<body>
<header>💬 Club Eslavo</header>

<div id="controls">
  <button id="loginBtn">🔑 Entrar com Google</button>
  <div>
    <button id="themeBtn">🌓</button>
    <button id="langBtn">🌍</button>
  </div>
</div>

<div id="chat">
  <div id="userList"><b>Usuários</b><br><small>Entrar para ver</small></div>
  <div id="chatWindow">
    <div id="messages"></div>
    <div id="inputArea">
      <input id="msgInput" placeholder="Digite sua mensagem...">
      <button id="sendBtn">Enviar</button>
    </div>
  </div>
</div>

<audio id="msgSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_0c9a9a8a46.mp3"></audio>

<script>
/* === Firebase Config === */
const firebaseConfig = {
  apiKey: "AIzaSyD...",
  authDomain: "clubeslavo.firebaseapp.com",
  databaseURL: "https://clubeslavo-default-rtdb.firebaseio.com",
  projectId: "clubeslavo",
  storageBucket: "clubeslavo.appspot.com",
  messagingSenderId: "1",
  appId: "1:1:web:1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

/* === Elementos === */
const loginBtn = document.getElementById('loginBtn');
const sendBtn = document.getElementById('sendBtn');
const msgInput = document.getElementById('msgInput');
const messagesDiv = document.getElementById('messages');
const userList = document.getElementById('userList');
const themeBtn = document.getElementById('themeBtn');
const langBtn = document.getElementById('langBtn');
const msgSound = document.getElementById('msgSound');

let currentUser = null;
let currentLang = 'pt';

/* === Login === */
loginBtn.onclick = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
};
auth.onAuthStateChanged(u => {
  if (u) {
    currentUser = u;
    loginBtn.textContent = "👋 " + u.displayName;
    loadUsers();
    listenMessages();
  }
});

/* === Enviar mensagem === */
sendBtn.onclick = sendMsg;
msgInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMsg();
});

function sendMsg() {
  if (!msgInput.value.trim() || !currentUser) return;
  const text = msgInput.value.trim();
  msgInput.value = '';
  db.ref('messages').push({
    uid: currentUser.uid,
    user: currentUser.displayName,
    text: text,
    time: Date.now()
  });
}

/* === Receber mensagens === */
function listenMessages() {
  db.ref('messages').on('child_added', snap => {
    const msg = snap.val();
    showMsg(msg);
    if (msg.uid !== currentUser.uid) msgSound.play();
  });
}

/* === Mostrar mensagem === */
function showMsg(m) {
  const div = document.createElement('div');
  div.className = 'message';
  div.innerHTML = `<b>${m.user}</b>: ${m.text} <br>
    <button onclick="translateMessage('${m.text.replace(/'/g,"\\'")}', this.parentElement)">🌍 Traduzir</button>`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

/* === Tradução automática === */
async function translateMessage(text, parent) {
  const loading = document.createElement('small');
  loading.className = 'translated';
  loading.textContent = '⏳ Traduzindo...';
  parent.appendChild(loading);
  try {
    const res = await fetch('https://libretranslate.de/translate', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({q: text, source: 'auto', target: currentLang, format: 'text'})
    });
    const data = await res.json();
    loading.textContent = `🔸 ${data.translatedText}`;
  } catch {
    loading.textContent = '❌ Erro ao traduzir';
  }
}

/* === Trocar tema === */
themeBtn.onclick = () => {
  document.body.classList.toggle('light');
};

/* === Trocar idioma === */
langBtn.onclick = () => {
  currentLang = currentLang === 'pt' ? 'ru' : 'pt';
  langBtn.textContent = currentLang === 'pt' ? '🌍' : '🇷🇺';
  msgInput.placeholder = currentLang === 'pt' ? 'Digite sua mensagem...' : 'Введите сообщение...';
};

/* === Lista de usuários === */
function loadUsers() {
  db.ref('presence/' + currentUser.uid).set({name: currentUser.displayName, online: true});
  db.ref('presence/' + currentUser.uid).onDisconnect().remove();

  db.ref('presence').on('value', snap => {
    const users = snap.val() || {};
    userList.innerHTML = '<b>Usuários</b><br>';
    for (const [uid, info] of Object.entries(users)) {
      const p = document.createElement('p');
      p.textContent = info.name + (uid === currentUser.uid ? ' (você)' : '');
      userList.appendChild(p);
    }
  });
}
</script>
</body>
</html>
