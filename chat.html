<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>—á–∞—Ç üåç</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root {
  --color-bg-light: #f5f5f5;
  --color-primary: #4CAF50;
  --color-primary-hover: #45a049;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:Arial, sans-serif; background:var(--color-bg-light); }

/* HEADER */
header {
  background:#fff;
  padding:10px;
  border-bottom:1px solid #ddd;
  display:flex;
  align-items:center;
  gap:8px;
  position:fixed;
  top:0; left:0; right:0;
  z-index:10;
}
header h1 { color:var(--color-primary); font-size:1.3em; display:flex; align-items:center; gap:6px; }
.emoji-head { width:28px; }

/* TOPBAR */
#topBar {
  display:flex;
  gap:8px;
  padding:8px;
  background:#fafafa;
  border-bottom:1px solid #ddd;
  margin-top:50px;
  flex-wrap:wrap;
}
#topBar button {
  background:white;
  color:var(--color-primary);
  border:1px solid var(--color-primary);
  border-radius:5px;
  padding:6px 10px;
  cursor:pointer;
}
#topBar button:hover { background:var(--color-primary-hover); color:#fff; }

/* MAIN */
#mainContent { display:flex; height:calc(100vh - 130px); }

/* USERLIST */
#userList {
  width:200px;
  background:white;
  border-right:1px solid #ddd;
  overflow-y:auto;
  transition:all 0.3s ease;
}
.userItem {
  display:flex;
  align-items:center;
  gap:6px;
  padding:6px;
  cursor:pointer;
  border-radius:5px;
  margin:4px;
}
.userItem:hover { background:#e8f8ee; }
.userItem img { width:28px; height:28px; border-radius:50%; }

/* CHAT */
#chatContainer {
  flex:1;
  display:flex;
  flex-direction:column;
  background:white;
  border-left:1px solid #ddd;
}
#chatHeader {
  padding:6px;
  background:#fafafa;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#chatHeader h2 { font-size:1em; color:#333; }
#chatWindow { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; }
.msg {
  margin:5px 0;
  padding:8px;
  border-radius:8px;
  max-width:80%;
  word-wrap:break-word;
  position:relative;
}
.userMsg { background:#e0f7e9; align-self:flex-end; text-align:right; }
.otherMsg { background:#fff8dc; align-self:flex-start; text-align:left; }
.msg .deleteBtn {
  position:absolute;
  top:2px;
  right:5px;
  font-size:0.8em;
  color:red;
  cursor:pointer;
  display:none;
}
.userMsg:hover .deleteBtn { display:inline; }

/* INPUT */
#chatInput { display:flex; border-top:1px solid #ddd; }
#chatInput input {
  flex:1;
  padding:10px;
  border:none;
  outline:none;
}
#chatInput button {
  background:var(--color-primary);
  color:white;
  border:none;
  padding:10px 15px;
  cursor:pointer;
}

/* ADS */
#adSidebar {
  width:250px;
  background:#f7f7f7;
  border-left:1px dashed #ccc;
  text-align:center;
  padding:8px;
}

/* FOOTER */
footer {
  background:white;
  text-align:center;
  padding:6px;
  border-top:1px solid #ddd;
  font-size:0.85em;
  position:relative;
  z-index:5;
}

/* NOTIFICA√á√ïES */
#notificationContainer {
  position:fixed;
  top:70px;
  right:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:200;
}
.notification {
  background:#4CAF50;
  color:white;
  padding:10px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
  animation:slideIn 0.3s ease;
}
@keyframes slideIn {
  from { opacity:0; transform:translateX(50px); }
  to { opacity:1; transform:translateX(0); }
}

/* MOBILE */
@media(max-width:768px){
  #mainContent { flex-direction:column; height:auto; }
  #adSidebar { display:none; }

  /* Lista de usu√°rios retr√°til */
  #userList {
    position:fixed;
    top:100px;
    left:0;
    right:0;
    height:200px;
    border:1px solid #ccc;
    background:white;
    display:none;
    z-index:20;
  }
  #toggleUsers {
    background:var(--color-primary);
    color:white;
    border:none;
    padding:6px 10px;
    border-radius:5px;
  }
  footer {
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    z-index:100;
  }
  #chatContainer { height:calc(100vh - 220px); }
}
</style>
</head>
<body>

<header>
  <h1>–°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± <img src="emoji_dimitry.png" alt="Dimitry" class="emoji-head"></h1>
</header>

<div id="topBar">
  <button id="loginBtn">Login com Google</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
  <button id="generalBtn" style="display:none;">üí¨ Bate-papo Geral</button>
  <button id="toggleUsers" style="display:none;">üë• Usu√°rios</button>
  <span id="onlineCount">üë• Usu√°rios online: 0</span>
</div>

<div id="mainContent">
  <div id="userList"></div>

  <div id="chatContainer">
    <div id="chatHeader">
      <h2 id="chatTitle">üí¨ Bate-papo Geral</h2>
      <div>
        <button id="clearBtn">Apagar</button>
        <button id="blockBtn">Bloquear</button>
      </div>
    </div>
    <div id="chatWindow"></div>
    <div id="chatInput">
      <input id="msgInput" type="text" placeholder="Digite sua mensagem..." disabled>
      <button id="sendBtn" disabled>Enviar</button>
    </div>
  </div>

  <div id="adSidebar">Publicidade (Adsense)</div>
</div>

<footer>¬© 2025 –°–ª–∞–≤—è–Ω—Å–∫–∏–π –∫–ª—É–± ‚Äî Aprenda Russo e Portugu√™s</footer>

<!-- Container de notifica√ß√µes -->
<div id="notificationContainer"></div>

<!-- √Åudio de notifica√ß√£o -->
<audio id="msgSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2a8c4e8d5a.mp3?filename=message-pop-alert-23584.mp3" preload="auto"></audio>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYJCgfil5HKrCWtB14zwdicDaEcldHU6A",
  authDomain: "dimitry-rusian.firebaseapp.com",
  databaseURL: "https://dimitry-rusian-default-rtdb.firebaseio.com",
  projectId: "dimitry-rusian",
  storageBucket: "dimitry-rusian.appspot.com",
  messagingSenderId: "449029666805",
  appId: "1:449029666805:web:feaf575a7b7e6f234a52bc"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth(), db=firebase.database();

const loginBtn=document.getElementById("loginBtn"),
logoutBtn=document.getElementById("logoutBtn"),
generalBtn=document.getElementById("generalBtn"),
toggleUsers=document.getElementById("toggleUsers"),
userList=document.getElementById("userList"),
msgInput=document.getElementById("msgInput"),
sendBtn=document.getElementById("sendBtn"),
chatWindow=document.getElementById("chatWindow"),
chatTitle=document.getElementById("chatTitle"),
clearBtn=document.getElementById("clearBtn"),
blockBtn=document.getElementById("blockBtn"),
msgSound=document.getElementById("msgSound"),
notificationContainer=document.getElementById("notificationContainer"),
onlineCount=document.getElementById("onlineCount");

let currentUser=null,currentChat="chatGlobal",blocked={},currentPartner=null;

loginBtn.onclick=()=>auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
logoutBtn.onclick=()=>auth.signOut();

auth.onAuthStateChanged(u=>{
  if(u){
    currentUser=u;
    loginBtn.style.display="none";
    logoutBtn.style.display="inline-block";
    generalBtn.style.display="inline-block";
    toggleUsers.style.display="inline-block";
    msgInput.disabled=false;
    sendBtn.disabled=false;

    db.ref("online/"+u.uid).set({name:u.displayName,photo:u.photoURL});
    db.ref("online/"+u.uid).onDisconnect().remove();

    updateUsers();
    openGlobal();
  }else{
    currentUser=null;
    loginBtn.style.display="inline-block";
    logoutBtn.style.display="none";
    generalBtn.style.display="none";
    toggleUsers.style.display="none";
    msgInput.disabled=true;
    sendBtn.disabled=true;
    chatWindow.innerHTML="";
    userList.innerHTML="";
    onlineCount.textContent="üë• Usu√°rios online: 0";
  }
});

toggleUsers.onclick=()=>{
  userList.style.display=(userList.style.display==="block")?"none":"block";
};

function updateUsers(){
  db.ref("online").on("value",snap=>{
    const data=snap.val()||{};
    userList.innerHTML="";
    onlineCount.textContent="üë• Usu√°rios online: "+Object.keys(data).length;
    for(const [uid,u] of Object.entries(data)){
      if(currentUser && uid===currentUser.uid) continue;
      const div=document.createElement("div");
      div.className="userItem";
      div.innerHTML=`<img src="${u.photo}"><span>${u.name}</span>`;
      div.onclick=()=>openPrivate(uid,u.name);
      userList.appendChild(div);
    }
  });
}

// === FUN√á√ÉO DE NOTIFICA√á√ÉO ===
function showNotification(user,chatType){
  const n=document.createElement("div");
  n.className="notification";
  n.textContent=`üì© Nova mensagem de ${user} (${chatType})`;
  notificationContainer.appendChild(n);
  setTimeout(()=>n.remove(),4000);
  msgSound.currentTime=0;
  msgSound.play();
}

function openGlobal(){
  currentChat="chatGlobal";
  currentPartner=null;
  chatTitle.textContent="üí¨ Bate-papo Geral";
  chatWindow.innerHTML="";
  db.ref("chatGlobal").off();
  db.ref("chatGlobal").limitToLast(100).on("child_added",snap=>{
    const m=snap.val();
    renderMsg(snap.key,m);
    if(currentChat!=="chatGlobal" && m.uid!==currentUser?.uid) showNotification(m.user,"Geral");
  });
}

function openPrivate(uid,name){
  currentPartner=uid;
  currentChat="private/"+[currentUser.uid,uid].sort().join("_");
  chatTitle.textContent="üë§ "+name;
  chatWindow.innerHTML="";
  db.ref(currentChat).off();
  db.ref(currentChat).limitToLast(100).on("child_added",snap=>{
    const m=snap.val();
    renderMsg(snap.key,m);
    if(currentChat!==("private/"+[currentUser.uid,uid].sort().join("_")) && m.uid!==currentUser?.uid) showNotification(m.user,"Privado");
  });
}

function renderMsg(key,m){
  const div=document.createElement("div");
  div.className=m.uid===currentUser?.uid?"msg userMsg":"msg otherMsg";
  div.innerHTML=`${m.user}: ${m.text}`;
  if(m.uid===currentUser?.uid){
    const del=document.createElement("span");
    del.className="deleteBtn";
    del.textContent="‚ùå";
    del.onclick=()=>deleteMsg(key);
    div.appendChild(del);
  }
  chatWindow.appendChild(div);
  chatWindow.scrollTop=chatWindow.scrollHeight;
  if(m.uid!==currentUser?.uid && currentChat==="chatGlobal"){
    msgSound.currentTime=0;
    msgSound.play();
  }
}

sendBtn.onclick=sendMsg;
msgInput.addEventListener("keypress",e=>{if(e.key==="Enter")sendMsg();});
function sendMsg(){
  if(!currentUser)return;
  const text=msgInput.value.trim();
  if(!text)return;
  db.ref(currentChat).push({
    uid:currentUser.uid,
    user:currentUser.displayName,
    text,
    timestamp:Date.now()
  });
  msgInput.value="";
}

function deleteMsg(key){
  db.ref(currentChat+"/"+key).once("value").then(snap=>{
    const msg=snap.val();
    if(msg && msg.uid===currentUser.uid){
      db.ref(currentChat+"/"+key).remove();
      alert("Mensagem apagada com sucesso.");
    }else{
      alert("Voc√™ s√≥ pode apagar suas pr√≥prias mensagens.");
    }
  });
}

clearBtn.onclick=()=>{ chatWindow.innerHTML=""; };
blockBtn.onclick=()=>{
  if(!currentPartner)return alert("Selecione um usu√°rio para bloquear.");
  blocked[currentPartner]=!blocked[currentPartner];
  alert(blocked[currentPartner]?"Usu√°rio bloqueado":"Usu√°rio desbloqueado");
};
generalBtn.onclick=openGlobal;
</script>

</body>
</html>
